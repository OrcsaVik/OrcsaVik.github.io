import{_ as e,C as n,c as p,o as l,j as s,G as i,ai as o,a as r}from"./chunks/framework.6CbiclxB.js";const v=JSON.parse('{"title":"Seta事务","description":"","frontmatter":{"title":"Seta事务"},"headers":[],"relativePath":"articles/java/middle-frame/Seta事务.md","filePath":"articles/java/middle-frame/Seta事务.md","lastUpdated":1768136749000}'),d={name:"articles/java/middle-frame/Seta事务.md"};function c(h,a,u,g,b,m){const t=n("ArticleMetadata");return l(),p("div",null,[a[0]||(a[0]=s("h1",{id:"seta事务",tabindex:"-1"},[r("SETA事务 "),s("a",{class:"header-anchor",href:"#seta事务","aria-label":'Permalink to "SETA事务"'},"​")],-1)),i(t),a[1]||(a[1]=o(`<p>默认使用</p><p>XA 两阶段事务</p><p>AT（事务全局事务）</p><p>非常好 👍 你现在已经抓住了 Seata 的核心结构：<strong>TC / TM / RM</strong> 三者的协作是分布式事务能否正确运行的关键。 下面是它们之间的 <strong>核心关系依据与交互机制</strong>（建议你掌握到这个层次👇）。</p><hr><h2 id="🧩-一、三者角色逻辑关系总览" tabindex="-1">🧩 一、三者角色逻辑关系总览 <a class="header-anchor" href="#🧩-一、三者角色逻辑关系总览" aria-label="Permalink to &quot;🧩 一、三者角色逻辑关系总览&quot;">​</a></h2><table tabindex="0"><thead><tr><th>组件</th><th>全称</th><th>职责</th><th>关键所在</th></tr></thead><tbody><tr><td><strong>TC</strong></td><td>Transaction Coordinator（事务协调者）</td><td>维护<strong>全局事务状态</strong>与<strong>分支事务状态</strong>，协调全局提交或回滚</td><td>分布式事务的“大脑”</td></tr><tr><td><strong>TM</strong></td><td>Transaction Manager（事务管理器）</td><td>定义事务边界，负责<strong>开启/提交/回滚</strong>全局事务</td><td>向 TC 注册全局事务</td></tr><tr><td><strong>RM</strong></td><td>Resource Manager（资源管理器）</td><td>控制具体数据库资源（如 MySQL），执行本地事务</td><td>向 TC 注册、报告分支事务状态</td></tr></tbody></table><hr><h2 id="🔁-二、三者交互流程-全局事务生命周期" tabindex="-1">🔁 二、三者交互流程（全局事务生命周期） <a class="header-anchor" href="#🔁-二、三者交互流程-全局事务生命周期" aria-label="Permalink to &quot;🔁 二、三者交互流程（全局事务生命周期）&quot;">​</a></h2><p>以下是一个典型 <strong>全局事务（Global Transaction）</strong> 的调用流程（也是理解依据）：</p><h3 id="step-1️⃣-tm-开启全局事务" tabindex="-1">Step 1️⃣ TM 开启全局事务 <a class="header-anchor" href="#step-1️⃣-tm-开启全局事务" aria-label="Permalink to &quot;Step 1️⃣ TM 开启全局事务&quot;">​</a></h3><ul><li><p>TM（事务管理器）在业务逻辑入口处（如 <code>@GlobalTransactional</code> 注解标记的方法） 向 <strong>TC</strong> 发送：</p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Begin Global Transaction Request</span></span></code></pre></div></li><li><p>TC 创建一个全局事务 ID（<code>XID</code>），返回给 TM。</p></li></ul><hr><h3 id="step-2️⃣-rm-注册分支事务" tabindex="-1">Step 2️⃣ RM 注册分支事务 <a class="header-anchor" href="#step-2️⃣-rm-注册分支事务" aria-label="Permalink to &quot;Step 2️⃣ RM 注册分支事务&quot;">​</a></h3><ul><li><p>TM 在业务调用链中传递 <code>XID</code>（例如跨多个微服务调用）。</p></li><li><p>每个微服务的 RM 在执行本地数据库操作前：</p><ul><li><p>向 <strong>TC 注册</strong>一个分支事务：</p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Branch Register Request (with XID)</span></span></code></pre></div></li><li><p>由 TC 记录下这个分支属于哪个全局事务。</p></li></ul></li></ul><hr><h3 id="step-3️⃣-rm-执行本地事务-try-阶段" tabindex="-1">Step 3️⃣ RM 执行本地事务（Try 阶段） <a class="header-anchor" href="#step-3️⃣-rm-执行本地事务-try-阶段" aria-label="Permalink to &quot;Step 3️⃣ RM 执行本地事务（Try 阶段）&quot;">​</a></h3><ul><li>RM 执行本地 SQL 时，会先在 undo_log 表中记录 <strong>反向补偿信息</strong>（保证可回滚）。</li></ul><hr><h3 id="step-4️⃣-tm-请求提交-回滚" tabindex="-1">Step 4️⃣ TM 请求提交/回滚 <a class="header-anchor" href="#step-4️⃣-tm-请求提交-回滚" aria-label="Permalink to &quot;Step 4️⃣ TM 请求提交/回滚&quot;">​</a></h3><ul><li><p>当业务方法执行完毕：</p><ul><li><p>若成功 → TM 向 TC 发送：</p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Global Commit Request (XID)</span></span></code></pre></div></li><li><p>若异常 → TM 向 TC 发送：</p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Global Rollback Request (XID)</span></span></code></pre></div></li></ul></li></ul><hr><h3 id="step-5️⃣-tc-驱动-rm-提交或回滚" tabindex="-1">Step 5️⃣ TC 驱动 RM 提交或回滚 <a class="header-anchor" href="#step-5️⃣-tc-驱动-rm-提交或回滚" aria-label="Permalink to &quot;Step 5️⃣ TC 驱动 RM 提交或回滚&quot;">​</a></h3><ul><li><p>TC 根据上一步的请求，逐个通知各个分支的 RM：</p><ul><li><p>提交时：</p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Branch Commit Request</span></span></code></pre></div></li><li><p>回滚时：</p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Branch Rollback Request</span></span></code></pre></div></li></ul></li><li><p>RM 执行实际数据库提交或反向补偿，然后报告状态回 TC。</p></li></ul><hr><h2 id="📘-三、关系图示-核心理解结构" tabindex="-1">📘 三、关系图示（核心理解结构） <a class="header-anchor" href="#📘-三、关系图示-核心理解结构" aria-label="Permalink to &quot;📘 三、关系图示（核心理解结构）&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>            ┌──────────────┐</span></span>
<span class="line"><span>            │     TM       │</span></span>
<span class="line"><span>            │(事务管理器)   │</span></span>
<span class="line"><span>            └──────┬───────┘</span></span>
<span class="line"><span>                   │开启/提交/回滚</span></span>
<span class="line"><span>                   ▼</span></span>
<span class="line"><span>            ┌──────────────┐</span></span>
<span class="line"><span>            │     TC       │</span></span>
<span class="line"><span>            │(事务协调者)   │</span></span>
<span class="line"><span>            └──────┬───────┘</span></span>
<span class="line"><span>                   │协调/通知</span></span>
<span class="line"><span>          ┌────────┴────────┐</span></span>
<span class="line"><span>          ▼                 ▼</span></span>
<span class="line"><span> ┌──────────────┐   ┌──────────────┐</span></span>
<span class="line"><span> │     RM1      │   │     RM2      │</span></span>
<span class="line"><span> │(资源管理器)   │   │(资源管理器)   │</span></span>
<span class="line"><span> └──────────────┘   └──────────────┘</span></span></code></pre></div><hr>`,28))])}const C=e(d,[["render",c]]);export{v as __pageData,C as default};
