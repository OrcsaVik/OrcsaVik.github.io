import{_ as a,c as i,o as n,ai as t}from"./chunks/framework.6CbiclxB.js";const c=JSON.parse('{"title":"SkyWalking 告警规则配置：从指标监控到主动响应","description":"","frontmatter":{"title":"SkyWalking 告警规则配置：从指标监控到主动响应"},"headers":[],"relativePath":"system-design/SkyWalking 告警规则配置：从指标监控到主动响应.md","filePath":"system-design/SkyWalking 告警规则配置：从指标监控到主动响应.md","lastUpdated":1768136749000}'),e={name:"system-design/SkyWalking 告警规则配置：从指标监控到主动响应.md"};function l(p,s,h,k,r,d){return n(),i("div",null,[...s[0]||(s[0]=[t(`<p>在完成 SkyWalking 镜像构建与指标观察后，手动盯着控制台并非长久之计。通过配置 <code>alarm-settings.yml</code>，你可以让系统在性能指标异常（如成功率下降）时，自动通过 Webhook 推送通知至钉钉、企业微信或自定义 API。</p><h3 id="_1-核心配置文件定位" tabindex="-1">1. 核心配置文件定位 <a class="header-anchor" href="#_1-核心配置文件定位" aria-label="Permalink to &quot;1. 核心配置文件定位&quot;">​</a></h3><p>SkyWalking 的所有告警逻辑均由后端 OAP Server 管理，配置文件位于： <code>skywalking-oap-server</code> 容器内部的 <code>/skywalking/config/alarm-settings.yml</code>。</p><hr><h3 id="_2-告警规则模板-服务成功率监控" tabindex="-1">2. 告警规则模板：服务成功率监控 <a class="header-anchor" href="#_2-告警规则模板-服务成功率监控" aria-label="Permalink to &quot;2. 告警规则模板：服务成功率监控&quot;">​</a></h3><p>以下是一个标准的告警配置模板。重点在于 <strong><code>service_sla_rule</code></strong>，它定义了当服务成功率低于预设阈值时的触发逻辑。</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">rules</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 规则名称：必须以 _rule 结尾</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  service_sla_rule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 度量指标名称：service_sla 代表服务成功率</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    metrics-name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">service_sla</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 操作符：&lt; 代表小于阈值触发</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    op</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&lt;&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 阈值：成功率低于 95%（注意：SkyWalking 内部 SLA 通常以 10000 为基数，即 9500 代表 95%）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 在 9.x+ 版本中，部分指标已适配为百分比数值，建议根据实际表现调整</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    threshold</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">9500</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 检查周期：最近 10 分钟</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    period</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 触发次数：连续 3 次满足条件则报警（过滤抖动）</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    count</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 沉默周期：触发后 5 分钟内不再重复报警</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    silence-period</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 告警信息模板</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;警报：服务 {name} 成功率低于 95%，当前成功率为 {value}%，请及时处理！&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Webhook 配置：告警消息的去向</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">webhooks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 你的自定义通知接口或机器人 Hook 地址</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">url</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">http://your-alert-service-api:8080/webhook</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # - url: [https://oapi.dingtalk.com/robot/send?access_token=xxxx](https://oapi.dingtalk.com/robot/send?access_token=xxxx) (钉钉示例)</span></span></code></pre></div><hr><h3 id="_3-告警规则参数详解-避坑指南" tabindex="-1">3. 告警规则参数详解（避坑指南） <a class="header-anchor" href="#_3-告警规则参数详解-避坑指南" aria-label="Permalink to &quot;3. 告警规则参数详解（避坑指南）&quot;">​</a></h3><table tabindex="0"><thead><tr><th><strong>参数名称</strong></th><th><strong>工程含义</strong></th><th><strong>调优策略</strong></th></tr></thead><tbody><tr><td><strong><code>metrics-name</code></strong></td><td>监控的 OAL 指标名</td><td>常用：<code>service_resp_time</code> (延迟), <code>service_sla</code> (成功率)。</td></tr><tr><td><strong><code>period</code></strong></td><td>时间窗口长度</td><td>建议设为 5-10 分钟。太短会导致误报，太长会延迟发现问题。</td></tr><tr><td><strong><code>count</code></strong></td><td>阈值触发频次</td><td><strong>核心避坑点</strong>：不要设为 1。网络波动或 GC 可能导致单次指标下跌，设为 3 可过滤大部分假报警。</td></tr><tr><td><strong><code>silence-period</code></strong></td><td>告警冷却时间</td><td>避免“告警风暴”。设为与处理问题所需的平均时间相当（如 5-10 分钟）。</td></tr></tbody></table><hr><h3 id="_4-自动化集成步骤" tabindex="-1">4. 自动化集成步骤 <a class="header-anchor" href="#_4-自动化集成步骤" aria-label="Permalink to &quot;4. 自动化集成步骤&quot;">​</a></h3><p>如果你希望在 Docker 环境下快速应用此配置，建议通过 <strong>Volume 挂载</strong> 方式覆盖：</p><p>Bash</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 在宿主机创建告警配置文件</span></span>
<span class="line"><span>vi ./config/alarm-settings.yml</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 在 docker-compose.yml 或 docker run 中挂载</span></span>
<span class="line"><span>docker run -d \\</span></span>
<span class="line"><span>  --name skywalking-oap \\</span></span>
<span class="line"><span>  -v $(pwd)/config/alarm-settings.yml:/skywalking/config/alarm-settings.yml \\</span></span>
<span class="line"><span>  apache/skywalking-oap-server:9.x.x</span></span></code></pre></div><h3 id="_5-如何验证告警是否生效" tabindex="-1">5. 如何验证告警是否生效？ <a class="header-anchor" href="#_5-如何验证告警是否生效" aria-label="Permalink to &quot;5. 如何验证告警是否生效？&quot;">​</a></h3><ol><li><strong>触发错误</strong>：人为通过接口制造 404 或 500 错误。</li><li><strong>观察面板</strong>：在 SkyWalking UI 的 <code>Alarm</code> 菜单下查看是否有对应的条目生成。</li><li><strong>检查 Webhook</strong>：检查你的通知端（如钉钉群）是否收到 JSON 格式的 POST 请求。</li></ol>`,17)])])}const g=a(e,[["render",l]]);export{c as __pageData,g as default};
