import{_ as e,C as t,c as l,o as n,j as i,G as h,ai as r,a as k}from"./chunks/framework.6CbiclxB.js";const C=JSON.parse('{"title":"Docker挂载和镜像管理","description":"","frontmatter":{"title":"Docker挂载和镜像管理"},"headers":[],"relativePath":"articles/java/cloud/Docker挂载和镜像管理.md","filePath":"articles/java/cloud/Docker挂载和镜像管理.md","lastUpdated":1768121571000}'),p={name:"articles/java/cloud/Docker挂载和镜像管理.md"};function d(o,s,F,c,g,b){const a=t("ArticleMetadata");return n(),l("div",null,[s[0]||(s[0]=i("h1",{id:"docker-镜像管理",tabindex:"-1"},[k("Docker 镜像管理 "),i("a",{class:"header-anchor",href:"#docker-镜像管理","aria-label":'Permalink to "Docker 镜像管理"'},"​")],-1)),h(a),s[1]||(s[1]=r(`<h3 id="镜像源地址" tabindex="-1">镜像源地址 <a class="header-anchor" href="#镜像源地址" aria-label="Permalink to &quot;镜像源地址&quot;">​</a></h3><ul><li>~~<a href="https://github.com/stilleshan/dockerfiles~~" target="_blank" rel="noreferrer">https://github.com/stilleshan/dockerfiles~~</a></li><li><a href="https://docker.aityp.com/manage/api" target="_blank" rel="noreferrer">API接口 - 渡渡鸟容器同步站</a></li><li><a href="https://dockerproxy.net/" target="_blank" rel="noreferrer">https://dockerproxy.net/</a></li></ul><h3 id="镜像拉取机制" tabindex="-1">镜像拉取机制 <a class="header-anchor" href="#镜像拉取机制" aria-label="Permalink to &quot;镜像拉取机制&quot;">​</a></h3><ol><li>使用 apiserver 发送对应请求</li><li>API 通过 proxy 拉取指定域名的镜像</li><li>若镜像不存在则返回报错</li><li>若镜像存在则拉取并存储在 imagestore 中</li></ol><h3 id="镜像标签管理" tabindex="-1">镜像标签管理 <a class="header-anchor" href="#镜像标签管理" aria-label="Permalink to &quot;镜像标签管理&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tag</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/wurstmeister/kafka:latest</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> linhaixin.registry/library/kafka:latest</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tag</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/rabbitmq:3.13.3-management</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> linhaixin.registry/library/rabbitmq:3.13.3</span></span></code></pre></div><h2 id="磁盘使用分析" tabindex="-1">磁盘使用分析 <a class="header-anchor" href="#磁盘使用分析" aria-label="Permalink to &quot;磁盘使用分析&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[root@vbox vagrant]# df -h</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Filesystem</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      Size</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  Used</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Avail</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Use%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Mounted</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> on</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">devtmpfs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        1.9G</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  1.9G</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   0%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /dev</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tmpfs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">           1.9G</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  1.9G</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   0%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /dev/shm</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tmpfs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">           1.9G</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  9.2M</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  1.9G</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   1%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /run</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tmpfs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">           1.9G</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  1.9G</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   0%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /sys/fs/cgroup</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/dev/sda1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        40G</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   23G</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   18G</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  56%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tmpfs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">           379M</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  379M</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   0%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /run/user/1000</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">overlay</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          40G</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   23G</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   18G</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  56%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/lib/docker/overlay2/4565415149d90e699c57e2f7962e2342e60ed8e14bfd62567e59c7817fefc9f3/merged</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">overlay</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          40G</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   23G</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   18G</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  56%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/lib/docker/overlay2/42ffe31dec182869460d4c87ddab22b3768d0c19fcf2a98c80850f2d00ff2330/merged</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">overlay</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          40G</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   23G</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   18G</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  56%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/lib/docker/overlay2/340e2fac3aa7219a608fb784103ce6e5668376004d72b798a80114bd846e6fa9/merged</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">shm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">              64M</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   64M</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   0%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/lib/docker/containers/12d73c0e920bad8e5c999862c4d5a13c11aad47ea147f80d20ac79e1e9d5b035/mounts/shm</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">shm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">              64M</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   64M</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   0%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/lib/docker/containers/837970378f852e497d47f8f55ec01f55a78677b806b2a63631c0f7effd0f0fb0/mounts/shm</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">shm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">              64M</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   64M</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   0%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/lib/docker/containers/11cfbfee1f0af410b029fdd6e2edee9957ad77fac57ae029347af0b9fcf4a72d/mounts/shm</span></span></code></pre></div><h2 id="多个-overlay-挂载点" tabindex="-1">多个 <code>overlay</code> 挂载点 <a class="header-anchor" href="#多个-overlay-挂载点" aria-label="Permalink to &quot;多个 \`overlay\` 挂载点&quot;">​</a></h2><p>这些是 <strong>Docker 容器的存储层</strong>：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">overlay</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ...</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/lib/docker/overlay2/xxx/merged</span></span></code></pre></div><h3 id="关键信息" tabindex="-1">关键信息 <a class="header-anchor" href="#关键信息" aria-label="Permalink to &quot;关键信息&quot;">​</a></h3><ul><li>表示当前运行 <strong>至少 3 个 Docker 容器</strong></li><li>所有容器共享底层 <code>/dev/sda1</code> 的 40G 空间</li><li>Docker 镜像和容器数据都存储在 <code>/var/lib/docker</code> 下，计入 <code>/</code> 分区使用量</li></ul><h3 id="风险提示" tabindex="-1">风险提示 <a class="header-anchor" href="#风险提示" aria-label="Permalink to &quot;风险提示&quot;">​</a></h3><ul><li>Docker 容器的日志、镜像、卷会持续占用空间</li><li>即使容器删除，旧镜像可能仍存在</li><li>长期运行后容易“悄悄”占满磁盘</li></ul><h2 id="docker-隔离机制" tabindex="-1">Docker 隔离机制 <a class="header-anchor" href="#docker-隔离机制" aria-label="Permalink to &quot;Docker 隔离机制&quot;">​</a></h2><h3 id="mount-namespace" tabindex="-1">Mount Namespace <a class="header-anchor" href="#mount-namespace" aria-label="Permalink to &quot;Mount Namespace&quot;">​</a></h3><ul><li>使用 mount namespace 进行隔离</li><li>实现文件挂载隔离</li><li>其他隔离维度：gid、cpu、cid、network</li></ul><h2 id="rabbitmq-镜像对比" tabindex="-1">RabbitMQ 镜像对比 <a class="header-anchor" href="#rabbitmq-镜像对比" aria-label="Permalink to &quot;RabbitMQ 镜像对比&quot;">​</a></h2><h3 id="docker-io-rabbitmq-3-13-3-management" tabindex="-1">docker.io/rabbitmq:3.13.3-management <a class="header-anchor" href="#docker-io-rabbitmq-3-13-3-management" aria-label="Permalink to &quot;docker.io/rabbitmq:3.13.3-management&quot;">​</a></h3><ul><li>这是 RabbitMQ 的 <strong>主流服务器镜像</strong></li><li>包含 Web 管理界面</li><li>用于直接部署单个 RabbitMQ 实例</li></ul><h3 id="docker-io-rabbitmqoperator-cluster-operator-2-15-0" tabindex="-1">docker.io/rabbitmqoperator/cluster-operator:2.15.0 <a class="header-anchor" href="#docker-io-rabbitmqoperator-cluster-operator-2-15-0" aria-label="Permalink to &quot;docker.io/rabbitmqoperator/cluster-operator:2.15.0&quot;">​</a></h3><ul><li>这是一个 <strong>Kubernetes Operator</strong>，与服务器镜像有本质区别</li><li><strong>镜像来源</strong>：由 RabbitMQ 团队为 Kubernetes 环境开发</li><li><strong>主要功能</strong>： <ul><li>基于 Kubernetes CRD（自定义资源）声明式创建和管理 RabbitMQ 集群</li><li>自动处理集群的部署、扩缩容、故障恢复</li><li>管理 TLS 配置、插件启用、用户管理等</li><li>简化在 Kubernetes 上运行高可用 RabbitMQ 集群的运维复杂度</li></ul></li></ul>`,24))])}const u=e(p,[["render",d]]);export{C as __pageData,u as default};
