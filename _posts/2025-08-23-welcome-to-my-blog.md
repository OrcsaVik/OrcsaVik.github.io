当前时间：2025年8月19日，星期二17时38分。

---

你的坦诚非常好 — “一知半解”并不可怕，可怕的是**假装全懂还经不起追问**。作为严苛但负责的面试辅导者，我会帮你把“半懂”变成“真懂”，把“项目包装”变成“可落地的技术表达”。

我们来系统性拆解：**如何用这个 RPC 项目在大厂面试中站稳脚跟，甚至脱颖而出**。

---

## 一、面试官对自研框架项目的考察维度（四大核心板块）

即使你只做了“从0到1”的小框架，面试官也会按**分布式系统工程师的标准**来拷打。考察分为以下 **4 个层级**，层层递进：

| 考察维度              | 面试官目的                     | 常见问题类型                               |
| --------------------- | ------------------------------ | ------------------------------------------ |
| **1. 架构设计能力**   | 判断你是否具备抽象与分层思维   | “为什么选 Vert.x？” “SPI 怎么解耦？”       |
| **2. 核心实现深度**   | 验证你是否亲手写过、调过 Bug   | “粘包怎么解决？” “请求ID怎么匹配？”        |
| **3. 工程落地能力**   | 看你是否考虑过上线、压测、监控 | “QPS 多少？” “怎么灰度？”                  |
| **4. 技术权衡与反思** | 考察你是否能从失败中学习       | “如果重来你会改什么？” “和 Dubbo 差在哪？” |

> ✅ 你不需要每一层都答满分，但必须在 **2~3 层有扎实表现**，才能通过。

---

## 二、针对你的项目，必须深挖的 **5 大核心模块**（建议优先掌握）

你不需要掌握所有细节，但必须对以下 **5 个模块** 有清晰、自洽、可验证的理解。面试官会从中选 2~3 个深挖。

---

### 🔹 模块1：协议编解码与 TCP 通信（必问）

#### 你需要掌握：

- 协议帧结构：魔数(4B) + 版本(1B) + 序列化(1B) + 类型(1B) + 状态(1B) + 请求ID(8B) + 长度(4B) + 体(NB)
- **为什么魔数是 4 字节？** → 防止非法连接，如 `0xCAFEBABE`
- **如何解决粘包？** → 用 `LengthField` 读取完整帧（Netty/Vert.x 都支持）
- **请求-响应如何匹配？** → 用 `requestId` 做唯一标识，客户端维护 `Map<requestId, CompletableFuture>`

#### 可能追问：

> “如果 body 很大，分多个 TCP 包发送，你怎么保证一次性读完？”  
> “CompletableFuture 存久了会不会内存泄漏？怎么清理？”

✅ **建议准备**：画一张协议帧图 + 请求匹配流程图。

---

### 🔹 模块2：服务注册与发现（必问）

#### 你需要掌握（重点澄清“双注册”含义）：

- “双注册” ≠ 同时连 Etcd 和 ZooKeeper  
- 正确含义：**通过 SPI 实现可切换的注册中心**，配置 `registry.type=etcd` 或 `zk`
- 抽象 `Registry` 接口，两个实现类：`EtcdRegistry` 和 `ZookeeperRegistry`
- **服务注册**：启动时写入节点（IP:port），设置 TTL 或临时节点
- **服务发现**：监听变更，更新本地缓存 `ConcurrentHashMap<serviceKey, List<Instance>>`
- **健康检测**：Etcd 用 Lease + 心跳续约；ZK 用临时节点自动删除

#### 可能追问：

> “ZooKeeper 的 Watch 是一次性触发的，你怎么实现持续监听？”  
> “Etcd 的 Watch 机制是流式，你怎么处理事件丢失？”

✅ **建议准备**：说清楚“**SPI + 策略模式**”实现切换，不是同时使用。

---

### 🔹 模块3：动态代理与调用流程（必问）

#### 你需要掌握：

- 使用 **JDK 动态代理** 拦截 `@RpcReference` 注解的方法调用
- 代理逻辑：
  1. 获取方法名、参数 → 封装为 `ProtocolMessageDTO`
  2. 触发服务发现 → 获取可用节点列表
  3. 负载均衡选择一个节点
  4. 序列化 → 发送请求
  5. 异步等待 `CompletableFuture` 返回
- **透明化**：对用户来说就像调本地方法

#### 可能追问：

> “CompletableFuture 怎么和 requestId 关联？”  
> “如果服务端没响应，客户端等多久？超时怎么设置？”

✅ **建议准备**：画一个调用链路图（Method Call → Proxy → Serialize → Send → Wait → Return）

---

### 🔹 模块4：容错与重试机制（高频追问）

#### 你需要掌握：

- 重试触发条件：连接失败、超时、网络异常（非业务异常）
- 使用 **Guava Retryer**，配置：
  - 最大重试 2 次
  - 指数退避（100ms → 200ms）
  - 仅对 `IOException` 重试
- **重试策略**：更换节点（Failover），不是同一个连接
- **幂等性提醒**：GET 类型接口可重试，POST 需业务自行保证

#### 可能追问：

> “重试时换节点，怎么获取新节点列表？”  
> “如果所有节点都失败，返回什么？”

✅ **建议准备**：强调“**重试不解决所有问题，需业务配合幂等**”

---

### 🔹 模块5：Spring 集成与启动器（加分项）

#### 你需要掌握：

- 实现 `yu-rpc-spring-boot-starter`

- `META-INF/spring.factories` 中配置 `EnableAutoConfiguration`

- 自动装配 `RpcClient`、`Registry`、`LoadBalancer` 等 Bean

- 支持 `application.yml` 配置：

  ```yaml
  yu-rpc:
    registry-type: etcd
    registry-address: 127.0.0.1:2379
    serializer: kryo
  ```

#### 可能追问：

> “怎么避免和 Dubbo 的自动装配冲突？”  
> “@RpcReference 是怎么被扫描并生成代理的？”

✅ **建议准备**：说清楚“**条件装配 + 配置隔离**”

---

## 三、如果我答出来了，面试官会继续深挖吗？

**会！而且更深！**

大厂面试是“**压力测试 + 探底测试**”。你答得越顺，面试官越怀疑“背的”，于是：

| 你答得好 → 面试官动作                  |
| -------------------------------------- |
| ✅ 问题升级：从“怎么做”到“为什么这么做” |
| ✅ 场景升级：从“正常流程”到“极端场景”   |
| ✅ 对比升级：让你和 Dubbo/gRPC 对比     |
| ✅ 改造升级：让你现场设计优化方案       |

### 示例深挖路径：

你答：“用 requestId 匹配请求响应”  
→ 追问：“如果 requestId 重复了怎么办？”  
→ 再问：“你怎么生成 requestId？用 UUID 还是原子递增？”  
→ 再问：“原子递增在多线程下性能如何？用 ThreadLocal 吗？”  
→ 再问：“如果客户端重启，requestId 从0开始，会和旧请求冲突吗？”

---

## 四、你现在最该做什么？（ actionable plan ）

### ✅ 第一步：放弃“全懂”幻想，聚焦 **3 个模块** 深度掌握

建议优先准备：

1. **协议编解码 + TCP 通信**
2. **服务注册发现（SPI 切换）**
3. **动态代理 + 调用流程**

### ✅ 第二步：每个模块准备“三件套”

- **一张图**：协议帧、调用链、注册流程
- **一段话**：30秒说清楚核心逻辑
- **一个坑**：讲一个你遇到的 Bug 和修复过程（如“最初没设超时，导致线程阻塞”）

### ✅ 第三步：模拟面试，自问自答

对着镜子或朋友，问自己：

> “你说用 SPI 切换注册中心，那我改配置不重启，能生效吗？”  
> “你怎么保证序列化兼容性？”

---

## 五、总结：如何让面试官觉得“这人靠谱”

不是看你用了多少技术，而是：

| 面试官想看到的 | 你该表现的                   |
| -------------- | ---------------------------- |
| **真做过**     | 能画图、能说 Bug、有数据     |
| **真理解**     | 能讲权衡、能说缺点、能对比   |
| **能落地**     | 能说监控、能说压测、能说灰度 |
| **有潜力**     | 能反思、能改进、能学习       |

---

📌 **最后建议**：  
把“**双注册 = 可切换**”这个点讲清楚，再准备一个“**我最初设计错了，后来改了**”的故事（比如魔数只用1字节，后来改成4字节），比背一百遍“高性能”都管用。

如需我帮你：

- 画协议帧图
- 写一段“30秒项目介绍”话术
- 模拟一场真实面试问答

请继续告诉我。
